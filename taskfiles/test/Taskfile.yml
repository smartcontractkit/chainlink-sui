version: "3"

tasks:
  default:
    desc: "Run unit and integration tests"
    cmds:
      - task: unit
      - task: integration
      - task: sui_unit

  unit:
    desc: "Run unit tests"
    cmds:
      - for:
          matrix:
            MODULE: [".", "./relayer"]
        cmd: cd {{ .ITEM.MODULE }} && go test {{.CLI_ARGS}} -tags=unit ./...

  integration:
    desc: "Run integration tests"
    cmds:
      - for:
          matrix:
            MODULE: [".", "./relayer"]
        cmd: cd {{ .ITEM.MODULE }} && go test {{.CLI_ARGS}} -tags=integration ./...

  integration-testnet:
    desc: "Run integration tests in testnet"
    cmds:
      - for:
          matrix:
            MODULE: [".", "./relayer"]
        cmd: cd {{ .ITEM.MODULE }} && go test {{.CLI_ARGS}} -tags="integration testnet" ./...

  sui_unit:
    desc: "Run Sui contract unit tests"
    cmd: ./contracts/scripts/test.sh
